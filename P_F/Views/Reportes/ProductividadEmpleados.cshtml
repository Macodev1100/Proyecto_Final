@model P_F.ViewModels.ReporteProductividadViewModel

@{
    ViewData["Title"] = "Productividad de Empleados";
}

<!-- Incluir Chart.js y librerías adicionales -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<div class="container-fluid px-4">
    <!-- Header del Reporte -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <div>
                    <h1 class="h3 mb-0 text-gray-800">
                        <i class="fas fa-users-cog text-primary me-2"></i>@ViewData["Title"]
                    </h1>
                    <p class="text-muted mb-0">Análisis detallado del rendimiento y productividad del equipo técnico</p>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="exportarReporte()">
                        <i class="fas fa-download"></i> Exportar PDF
                    </button>
                    <button type="button" class="btn btn-outline-success btn-sm" onclick="exportarExcel()">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <a asp-controller="Home" asp-action="Index" class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i>Volver
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros Avanzados -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-gradient-primary text-white">
            <div class="d-flex align-items-center">
                <i class="fas fa-filter me-2"></i>
                <h6 class="mb-0">Filtros de Análisis</h6>
                <button class="btn btn-sm btn-outline-light ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#filtrosCollapse">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
        </div>
        <div class="collapse show" id="filtrosCollapse">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <label for="tipoEmpleado" class="form-label">Tipo de Empleado</label>
                        <select class="form-select" id="tipoEmpleado" name="tipoEmpleado">
                            <option value="">Todos</option>
                            <option value="Mecanico">Mecánicos</option>
                            <option value="Supervisor">Supervisores</option>
                            <option value="Administrador">Administradores</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="fechaInicio" class="form-label">Fecha Inicio</label>
                        <input type="date" class="form-control" id="fechaInicio" name="fechaInicio" value="@Model?.FechaInicio?.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="col-md-3">
                        <label for="fechaFin" class="form-label">Fecha Fin</label>
                        <input type="date" class="form-control" id="fechaFin" name="fechaFin" value="@Model?.FechaFin?.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary flex-fill">
                                <i class="fas fa-search"></i> Aplicar Filtros
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="limpiarFiltros()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Métricas Principales -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow-sm h-100 metric-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Ingresos Período
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800 counter-value" data-target="@((int)(Model?.TotalIngresosPeriodo ?? 0))">
                                $0
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow-sm h-100 metric-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Órdenes Completadas
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800 counter-value" data-target="@(Model?.TotalOrdenesPeriodo ?? 0)">
                                0
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-check-circle fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow-sm h-100 metric-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Total Empleados
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800 counter-value" data-target="@(Model?.EmpleadosProductividad?.Count() ?? 0)">
                                0
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow-sm h-100 metric-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Mejor Empleado
                            </div>
                            <div class="h6 mb-0 font-weight-bold text-gray-800">
                                @(Model?.EmpleadosProductividad?.OrderByDescending(e => e.TotalIngresos).FirstOrDefault()?.NombreCompleto?.Split(' ').FirstOrDefault() ?? "N/A")
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-trophy fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos de Productividad -->
    @if (Model?.EmpleadosProductividad != null && Model.EmpleadosProductividad.Any())
    {
        <div class="row mb-4">
            <!-- Gráfico de Ingresos por Empleado -->
            <div class="col-xl-8 col-lg-7">
                <div class="card shadow-sm mb-4">
                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-bar me-2"></i>Ingresos por Empleado
                        </h6>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-cog"></i> Opciones
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="cambiarTipoGrafico('bar')">Gráfico de Barras</a></li>
                                <li><a class="dropdown-item" href="#" onclick="cambiarTipoGrafico('line')">Gráfico de Líneas</a></li>
                                <li><a class="dropdown-item" href="#" onclick="cambiarTipoGrafico('radar')">Gráfico Radar</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="position: relative; height: 400px;">
                            <canvas id="ingresosChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico de Distribución de Ingresos -->
            <div class="col-xl-4 col-lg-5">
                <div class="card shadow-sm mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-pie me-2"></i>Distribución de Ingresos
                        </h6>
                    </div>
                    <div class="card-body">
                        <div style="position: relative; height: 400px;">
                            <canvas id="distribucionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico de Eficiencia vs Órdenes -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-scatter me-2"></i>Eficiencia vs Órdenes Completadas
                        </h6>
                    </div>
                    <div class="card-body">
                        <div style="position: relative; height: 300px;">
                            <canvas id="eficienciaChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Tabla Detallada de Empleados -->
    @if (Model?.EmpleadosProductividad != null && Model.EmpleadosProductividad.Any())
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-table me-2"></i>Detalle de Productividad por Empleado
                        </h6>
                        <div class="input-group" style="max-width: 300px;">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="buscarEmpleado" placeholder="Buscar empleado...">
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="tablaEmpleados">
                                <thead class="table-light">
                                    <tr>
                                        <th>
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-user me-2"></i>Empleado
                                                <button class="btn btn-sm btn-link p-0 ms-1" onclick="ordenarTabla('nombre')">
                                                    <i class="fas fa-sort"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th>Especialidad</th>
                                        <th class="text-center">
                                            <div class="d-flex align-items-center justify-content-center">
                                                <i class="fas fa-check me-2"></i>Completadas
                                                <button class="btn btn-sm btn-link p-0 ms-1" onclick="ordenarTabla('completadas')">
                                                    <i class="fas fa-sort"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th class="text-center">
                                            <div class="d-flex align-items-center justify-content-center">
                                                <i class="fas fa-clock me-2"></i>En Proceso
                                                <button class="btn btn-sm btn-link p-0 ms-1" onclick="ordenarTabla('proceso')">
                                                    <i class="fas fa-sort"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th class="text-center">
                                            <div class="d-flex align-items-center justify-content-center">
                                                <i class="fas fa-dollar-sign me-2"></i>Ingresos
                                                <button class="btn btn-sm btn-link p-0 ms-1" onclick="ordenarTabla('ingresos')">
                                                    <i class="fas fa-sort"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th class="text-center">
                                            <div class="d-flex align-items-center justify-content-center">
                                                <i class="fas fa-percentage me-2"></i>Eficiencia
                                                <button class="btn btn-sm btn-link p-0 ms-1" onclick="ordenarTabla('eficiencia')">
                                                    <i class="fas fa-sort"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th class="text-center">
                                            <i class="fas fa-star me-2"></i>Rendimiento
                                        </th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var empleado in Model.EmpleadosProductividad.OrderByDescending(e => e.TotalIngresos))
                                    {
                                        var rendimientoClass = empleado.EficienciaCalculada >= 80 ? "success" : empleado.EficienciaCalculada >= 60 ? "warning" : "danger";
                                        var rendimientoTexto = empleado.EficienciaCalculada >= 80 ? "Excelente" : empleado.EficienciaCalculada >= 60 ? "Bueno" : "Mejorable";
                                        
                                        <tr class="empleado-row" data-nombre="@empleado.NombreCompleto.ToLower()" data-completadas="@empleado.OrdenesCompletadas" data-proceso="@empleado.OrdenesEnProceso" data-ingresos="@empleado.TotalIngresos" data-eficiencia="@empleado.EficienciaCalculada">
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-circle me-3">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                    <div>
                                                        <div class="fw-bold">@empleado.NombreCompleto</div>
                                                        <small class="text-muted">ID: @empleado.EmpleadoId</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-info rounded-pill">@empleado.Especialidad</span>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge bg-success rounded-pill fs-6">@empleado.OrdenesCompletadas</span>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge bg-warning rounded-pill fs-6">@empleado.OrdenesEnProceso</span>
                                            </td>
                                            <td class="text-center">
                                                <div class="fw-bold text-success">
                                                    $@empleado.TotalIngresos.ToString("N2")
                                                </div>
                                                @if (empleado.OrdenesCompletadas > 0)
                                                {
                                                    <small class="text-muted">Prom: $@((empleado.TotalIngresos / empleado.OrdenesCompletadas).ToString("N0"))</small>
                                                }
                                            </td>
                                            <td class="text-center">
                                                <div class="progress-container">
                                                    <div class="progress" style="height: 20px;">
                                                        <div class="progress-bar bg-@rendimientoClass" role="progressbar" style="width: @empleado.EficienciaCalculada%">
                                                            @empleado.EficienciaCalculada.ToString("F1")%
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge bg-@rendimientoClass">@rendimientoTexto</span>
                                            </td>
                                            <td class="text-center">
                                                <button class="btn btn-sm btn-outline-primary" onclick="verDetalle(@empleado.EmpleadoId)" title="Ver Detalle">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <a asp-controller="Empleados" asp-action="Details" asp-route-id="@empleado.EmpleadoId" 
                                                   class="btn btn-sm btn-outline-success" title="Perfil Completo">
                                                    <i class="fas fa-user-circle"></i>
                                                </a>
                                                <button class="btn btn-sm btn-outline-info" onclick="generarReporteIndividual(@empleado.EmpleadoId)" title="Reporte Individual">
                                                    <i class="fas fa-file-pdf"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-user-times fa-4x text-gray-300 mb-4"></i>
                        <h4 class="text-gray-600">No hay datos de productividad</h4>
                        <p class="text-muted mb-4">No se encontraron datos de productividad para el período seleccionado.</p>
                        <button class="btn btn-primary" onclick="location.reload()">
                            <i class="fas fa-refresh me-2"></i>Actualizar Datos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<!-- Modal de Detalle de Empleado -->
<div class="modal fade" id="modalDetalle" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-user-cog me-2"></i>Detalle de Productividad
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalDetalleContent">
                <!-- Contenido se carga dinámicamente -->
            </div>
        </div>
    </div>
</div>

<style>
.border-left-primary { border-left: 0.25rem solid #4e73df !important; }
.border-left-success { border-left: 0.25rem solid #1cc88a !important; }
.border-left-warning { border-left: 0.25rem solid #f6c23e !important; }
.border-left-info { border-left: 0.25rem solid #36b9cc !important; }

.metric-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.counter-value {
    opacity: 0;
    animation: fadeInUp 2s ease-out forwards;
}

.avatar-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, #4e73df, #224abe);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.progress-container {
    min-width: 120px;
}

.bg-gradient-primary {
    background: linear-gradient(45deg, #4e73df, #224abe);
}

.table th {
    border-top: none;
    font-weight: 600;
}

.empleado-row:hover {
    background-color: rgba(78, 115, 223, 0.05);
}

.card {
    border: none;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
}

.card-header {
    background-color: #f8f9fc;
    border-bottom: 1px solid #e3e6f0;
}

.card-header {
    background-color: #f8f9fc;
    border-bottom: 1px solid #e3e6f0;
}
</style>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            inicializarContadores();
            @if (Model?.EmpleadosProductividad != null && Model.EmpleadosProductividad.Any())
            {
                <text>
                    inicializarGraficoIngresos();
                    inicializarGraficoDistribucion();
                    inicializarGraficoEficiencia();
                </text>
            }
            configurarBusqueda();
        });

        function inicializarContadores() {
            const counters = document.querySelectorAll('.counter-value');
            counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-target')) || 0;
                let current = 0;
                const increment = target / 50;
                
                if (counter.textContent.includes('$')) {
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            current = target;
                            clearInterval(timer);
                        }
                        counter.textContent = '$' + Math.floor(current).toLocaleString();
                    }, 40);
                } else {
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            current = target;
                            clearInterval(timer);
                        }
                        counter.textContent = Math.floor(current);
                    }, 40);
                }
            });
        }

        @if (Model?.EmpleadosProductividad != null && Model.EmpleadosProductividad.Any())
        {
            <text>
                function inicializarGraficoIngresos() {
                    const ctx = document.getElementById('ingresosChart').getContext('2d');
                    
                    const empleadosData = @Html.Raw(Json.Serialize(Model.EmpleadosProductividad.Take(10).Select(e => new {
                        nombre = e.NombreCompleto.Split(' ')[0],
                        ingresos = e.TotalIngresos,
                        ordenes = e.OrdenesCompletadas
                    })));
                    
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: empleadosData.map(e => e.nombre),
                            datasets: [{
                                label: 'Ingresos ($)',
                                data: empleadosData.map(e => e.ingresos),
                                backgroundColor: 'rgba(78, 115, 223, 0.8)',
                                borderColor: 'rgba(78, 115, 223, 1)',
                                borderWidth: 2,
                                borderRadius: 5,
                                borderSkipped: false,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'top' },
                                tooltip: {
                                    backgroundColor: 'rgba(0,0,0,0.8)',
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    callbacks: {
                                        label: function(context) {
                                            return 'Ingresos: $' + context.parsed.y.toLocaleString();
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: { 
                                    grid: { display: false },
                                    ticks: { color: '#858796' }
                                },
                                y: { 
                                    beginAtZero: true, 
                                    grid: { color: 'rgba(0,0,0,0.1)' },
                                    ticks: { 
                                        color: '#858796',
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                function inicializarGraficoDistribucion() {
                    const ctx = document.getElementById('distribucionChart').getContext('2d');
                    
                    const empleadosData = @Html.Raw(Json.Serialize(Model.EmpleadosProductividad.Take(8).Select(e => new {
                        nombre = e.NombreCompleto.Split(' ')[0],
                        ingresos = e.TotalIngresos
                    })));
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: empleadosData.map(e => e.nombre),
                            datasets: [{
                                data: empleadosData.map(e => e.ingresos),
                                backgroundColor: [
                                    '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',
                                    '#858796', '#5a5c69', '#f8f9fc'
                                ],
                                borderWidth: 3,
                                borderColor: '#fff',
                                hoverBorderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'bottom', 
                                    labels: { 
                                        padding: 20, 
                                        usePointStyle: true,
                                        color: '#5a5c69'
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                                            return context.label + ': $' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                        }
                                    }
                                }
                            },
                            cutout: '60%'
                        }
                    });
                }

                function inicializarGraficoEficiencia() {
                    const ctx = document.getElementById('eficienciaChart').getContext('2d');
                    
                    const empleadosData = @Html.Raw(Json.Serialize(Model.EmpleadosProductividad.Select(e => new {
                        nombre = e.NombreCompleto.Split(' ')[0],
                        eficiencia = e.EficienciaCalculada,
                        ordenes = e.OrdenesCompletadas,
                        ingresos = e.TotalIngresos
                    })));
                    
                    new Chart(ctx, {
                        type: 'bubble',
                        data: {
                            datasets: [{
                                label: 'Empleados',
                                data: empleadosData.map(e => ({
                                    x: e.ordenes,
                                    y: e.eficiencia,
                                    r: Math.sqrt(e.ingresos) / 50
                                })),
                                backgroundColor: empleadosData.map(e => 
                                    e.eficiencia >= 80 ? 'rgba(28, 200, 138, 0.6)' :
                                    e.eficiencia >= 60 ? 'rgba(246, 194, 62, 0.6)' : 
                                    'rgba(231, 74, 59, 0.6)'
                                ),
                                borderColor: empleadosData.map(e => 
                                    e.eficiencia >= 80 ? 'rgba(28, 200, 138, 1)' :
                                    e.eficiencia >= 60 ? 'rgba(246, 194, 62, 1)' : 
                                    'rgba(231, 74, 59, 1)'
                                ),
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        title: function(context) {
                                            const index = context[0].dataIndex;
                                            return empleadosData[index].nombre;
                                        },
                                        label: function(context) {
                                            const index = context.dataIndex;
                                            const data = empleadosData[index];
                                            return [
                                                'Órdenes: ' + data.ordenes,
                                                'Eficiencia: ' + data.eficiencia.toFixed(1) + '%',
                                                'Ingresos: $' + data.ingresos.toLocaleString()
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Órdenes Completadas',
                                        color: '#5a5c69'
                                    },
                                    grid: { color: 'rgba(0,0,0,0.1)' },
                                    ticks: { color: '#858796' }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Eficiencia (%)',
                                        color: '#5a5c69'
                                    },
                                    grid: { color: 'rgba(0,0,0,0.1)' },
                                    ticks: { 
                                        color: '#858796',
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            </text>
        }

        function configurarBusqueda() {
            const buscarInput = document.getElementById('buscarEmpleado');
            if (buscarInput) {
                buscarInput.addEventListener('keyup', function() {
                    const filtro = this.value.toLowerCase();
                    const filas = document.querySelectorAll('.empleado-row');
                    
                    filas.forEach(fila => {
                        const nombre = fila.getAttribute('data-nombre');
                        if (nombre && nombre.includes(filtro)) {
                            fila.style.display = '';
                        } else {
                            fila.style.display = 'none';
                        }
                    });
                });
            }
        }

        function ordenarTabla(columna) {
            console.log('Ordenando por:', columna);
            // Implementar ordenamiento por columna
        }

        function verDetalle(empleadoId) {
            document.getElementById('modalDetalleContent').innerHTML = `
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('modalDetalle'));
            modal.show();
            
            setTimeout(() => {
                document.getElementById('modalDetalleContent').innerHTML = `
                    <div class="row">
                        <div class="col-12">
                            <h6>Detalle del Empleado ${empleadoId}</h6>
                            <p>Aquí se mostraría información detallada sobre la productividad, historial de trabajos, etc.</p>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Esta funcionalidad puede expandirse para mostrar gráficos detallados, historial de órdenes, comentarios de clientes, etc.
                            </div>
                        </div>
                    </div>
                `;
            }, 1000);
        }

        function exportarReporte() {
            console.log('Exportando reporte a PDF...');
            alert('Funcionalidad de exportación en desarrollo');
        }

        function exportarExcel() {
            console.log('Exportando a Excel...');
            alert('Funcionalidad de exportación en desarrollo');
        }

        function generarReporteIndividual(empleadoId) {
            console.log('Generando reporte individual para empleado:', empleadoId);
            alert('Funcionalidad en desarrollo - Reporte individual para empleado ' + empleadoId);
        }

        function limpiarFiltros() {
            document.getElementById('tipoEmpleado').selectedIndex = 0;
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';
        }

        function cambiarTipoGrafico(tipo) {
            console.log('Cambiando tipo de gráfico a:', tipo);
            alert('Funcionalidad en desarrollo - Cambiar a gráfico ' + tipo);
        }
    </script>
}